<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <title>Steno Warriors Transcription Software</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="lookup.js"></script>
  <script src="textLookup.js"></script>
  <script src="1c2.js"></script>
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com/">
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
  <!-- Login Container -->
  <div id="login-container" class="login-container">
    <div class="login-content">
      <h2>Welcome to Steno Warriors</h2>
      <p>Please sign in to access transcription tests</p>
      <div class="mobile-login-options">
        <button id="googleSignIn" class="google-signin-btn">
          <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google logo">
          Sign in with Google
        </button>
        <div class="email-login-form" style="margin-top: 20px;">
          <input type="email" id="login-email" placeholder="Email" class="login-input" required>
          <div class="password-container">
            <input type="password" id="login-password" placeholder="Password" class="login-input" minlength="6" required>
            <span class="toggle-password" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
          </div>
          <input type="password" id="confirm-password" placeholder="Confirm Password" class="login-input" minlength="6" style="margin-top: 8px; display: none;">
          <div id="error-message" class="error-message"></div>
          <div id="password-strength" style="margin: 5px 0; height: 4px; background: #eee; border-radius: 2px; display: none;">
            <div id="strength-bar" style="height: 100%; width: 0%; border-radius: 2px; transition: width 0.3s;"></div>
          </div>
          <button id="emailSignIn" class="sign-in-btn">Sign In</button>
          <p style="margin-top: 10px; text-align: center;">or</p>
          <button id="createAccount" class="create-account-btn">Create Account</button>
          <button id="toggleSignUp" class="create-account-btn" style="margin-top: 10px; display: none;">Back to Sign In</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rest of your existing HTML remains the same -->
  <!-- ... (header, main content, footer, etc.) ... -->

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB9vruL_f9KZPC-Ihdj3UuqcXSgy1Lzqm0",
      authDomain: "score-collection.firebaseapp.com",
      databaseURL: "https://score-collection-default-rtdb.firebaseio.com",
      projectId: "score-collection",
      storageBucket: "score-collection.firebasestorage.app",
      messagingSenderId: "720795371551",
      appId: "1:720795371551:web:78ff7863cbeaca0161ed2a",
      measurementId: "G-L6MHY1KCZ0"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();

    // DOM Elements
    const createAccountBtn = document.getElementById('createAccount');
    const toggleSignUpBtn = document.getElementById('toggleSignUp');
    const confirmPasswordField = document.getElementById('confirm-password');
    const passwordStrength = document.getElementById('password-strength');
    const strengthBar = document.getElementById('strength-bar');

    // Toggle between sign in and sign up
    createAccountBtn.addEventListener('click', () => {
      document.getElementById('emailSignIn').style.display = 'none';
      createAccountBtn.style.display = 'none';
      confirmPasswordField.style.display = 'block';
      passwordStrength.style.display = 'block';
      toggleSignUpBtn.style.display = 'block';
      document.querySelector('.email-login-form p').style.display = 'none';
    });

    toggleSignUpBtn.addEventListener('click', () => {
      document.getElementById('emailSignIn').style.display = 'block';
      createAccountBtn.style.display = 'block';
      confirmPasswordField.style.display = 'none';
      passwordStrength.style.display = 'none';
      toggleSignUpBtn.style.display = 'none';
      document.querySelector('.email-login-form p').style.display = 'block';
      showError('');
    });

    // Password strength indicator
    document.getElementById('login-password').addEventListener('input', function(e) {
      const password = e.target.value;
      const strength = calculatePasswordStrength(password);
      updateStrengthBar(strength);
    });

    function calculatePasswordStrength(password) {
      let strength = 0;
      if (password.length > 7) strength += 1;
      if (password.match(/[a-z]/)) strength += 1;
      if (password.match(/[A-Z]/)) strength += 1;
      if (password.match(/[0-9]/)) strength += 1;
      if (password.match(/[^a-zA-Z0-9]/)) strength += 1;
      return strength;
    }

    function updateStrengthBar(strength) {
      const colors = ['#ff0000', '#ff5a00', '#ff9a00', '#ffcc00', '#a0ff00', '#00ff00'];
      const percent = (strength / 5) * 100;
      strengthBar.style.width = `${percent}%`;
      strengthBar.style.background = colors[strength] || colors[0];
    }

    function togglePasswordVisibility() {
      const passwordField = document.getElementById('login-password');
      const confirmField = document.getElementById('confirm-password');
      const type = passwordField.type === 'password' ? 'text' : 'password';
      passwordField.type = type;
      confirmField.type = type;
    }

    function showError(message) {
      const errorElement = document.getElementById('error-message');
      errorElement.textContent = message;
      setTimeout(() => {
        if (errorElement.textContent === message) {
          errorElement.textContent = '';
        }
      }, 5000);
    }

    // Authentication Functions
    function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      
      // For mobile, use redirect instead of popup
      if (window.innerWidth <= 768) {
        auth.signInWithRedirect(provider)
          .then(() => {
            return auth.getRedirectResult();
          })
          .then((result) => {
            if (result.user) {
              console.log("User signed in:", result.user);
            }
          })
          .catch((error) => {
            console.error("Error signing in:", error);
            showError("Error signing in with Google");
          });
      } else {
        // Desktop still uses popup
        auth.signInWithPopup(provider)
          .then((result) => {
            console.log("User signed in:", result.user);
          })
          .catch((error) => {
            console.error("Error signing in:", error);
            showError("Error signing in with Google");
          });
      }
    }

    function signInWithEmail() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value.trim();
      
      showError('');
      
      if (!validateEmail(email)) {
        showError('Please enter a valid email address');
        return;
      }

      auth.signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
          console.log("User signed in:", userCredential.user);
        })
        .catch((error) => {
          let errorMessage;
          switch(error.code) {
            case 'auth/invalid-email':
              errorMessage = 'Invalid email address';
              break;
            case 'auth/user-disabled':
              errorMessage = 'Account disabled';
              break;
            case 'auth/user-not-found':
              errorMessage = 'Account not found';
              break;
            case 'auth/wrong-password':
              errorMessage = 'Incorrect password';
              break;
            default:
              errorMessage = 'Error signing in. Please try again.';
          }
          showError(errorMessage);
        });
    }

    function createAccount() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value.trim();
      const confirmPassword = document.getElementById('confirm-password').value.trim();
      
      showError('');
      
      if (!validateEmail(email)) {
        showError('Please enter a valid email address');
        return;
      }
      
      if (password.length < 6) {
        showError('Password must be at least 6 characters');
        return;
      }
      
      if (password !== confirmPassword) {
        showError('Passwords do not match');
        return;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          console.log("Account created successfully!");
          // Switch back to sign in view
          toggleSignUpBtn.click();
        })
        .catch((error) => {
          let errorMessage;
          switch(error.code) {
            case 'auth/invalid-email':
              errorMessage = 'Invalid email address';
              break;
            case 'auth/weak-password':
              errorMessage = 'Password should be at least 6 characters';
              break;
            case 'auth/email-already-in-use':
              errorMessage = 'Email already in use';
              break;
            case 'auth/operation-not-allowed':
              errorMessage = 'Account creation not allowed';
              break;
            default:
              errorMessage = 'Error creating account. Please try again.';
          }
          showError(errorMessage);
        });
    }

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    function signOut() {
      auth.signOut()
        .then(() => {
          console.log("User signed out");
        })
        .catch((error) => {
          console.error("Error signing out:", error);
          showError("Error signing out");
        });
    }

    // Auth State Listener (keep your existing one)
    // ... rest of your existing JavaScript ...
  </script>
</body>
</html>
